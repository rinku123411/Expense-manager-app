<ion-header class="dashboard-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button
        (click)="goBack()"
        fill="clear"
        aria-label="White"
        class="back-button"
      >
        <ion-icon
          class="back-icon"
          slot="icon-only"
          src="assets/icon/back.svg"
        ></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="dashboard-content">
  <div *ngIf="isLoading" class="loading-wrapper">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <div class="group-details" *ngIf="!isLoading && dashboard">
    <h3 class="group-name">{{ dashboard.groupName }}</h3>

    <div class="members-section">
      <table class="members-table">
        <thead>
          <tr>
            <th class="member-heading">Members</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of members">
            <td>{{ m.name }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Tabs -->
  <ion-segment class="tabs" [(ngModel)]="activeTab" value="expenses">
    <ion-segment-button value="expenses">
      <ion-label>Expenses</ion-label>
    </ion-segment-button>
    <ion-segment-button value="settlements">
      <ion-label>Settlements</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Expenses -->
  <div class="dashboard-section" *ngIf="activeTab === 'expenses'">
    <ul>
      <li *ngFor="let e of dashboard.expenses">
        {{ e.amount }} was paid by {{ e.paidByDisplay }} and split between
        {{ e.splitBetweenDisplay.join(", ") }} for {{ e.description }}.
      </li>
    </ul>
  </div>

  <!-- Settlements -->
  <div class="settlement-section" *ngIf="activeTab === 'settlements'">
    <ul>
      <li *ngFor="let settlement of dashboard.settlements">
        {{ settlement.toDisplay }} will receive {{ settlement.amount }} rupees
        from {{ settlement.fromDisplay }}
      </li>
    </ul>
  </div>

  <div *ngIf="!isLoading && !dashboard">
    No dashboard data available for group {{ groupId }}.
  </div>

  <!-- Add Expense FAB -->
  <ion-fab
    vertical="bottom"
    horizontal="end"
    slot="fixed"
    class="add-expense-fab"
  >
    <ion-fab-button (click)="openAddExpense()">
      <img
        src="assets/icon/rupee-icon.svg"
        alt="add Expense"
        class="rupee-icon-img"
      />
    </ion-fab-button>
  </ion-fab>

  <!-- Modal-like container -->
  <div class="modal-backdrop" *ngIf="showAddExpense">
    <div class="modal-container">
      <h2>Add Expense</h2>

      <ion-item>
        <ion-label position="stacked">Amount</ion-label>
        <ion-input type="number" [(ngModel)]="newExpenseAmount"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Description</ion-label>
        <ion-input
          type="string"
          [(ngModel)]="newExpenseDescription"
        ></ion-input>
      </ion-item>

      <ion-list>
        <ion-radio-group [(ngModel)]="splitType">
          <ion-item>
            <ion-radio slot="start" value="equal"></ion-radio>
            <ion-label>Split equally</ion-label>
          </ion-item>

          <ion-item>
            <ion-radio slot="start" value="between"></ion-radio>
            <ion-label>Split between</ion-label>
          </ion-item>
        </ion-radio-group>
      </ion-list>

      <div *ngIf="splitType === 'between'" class="members-list">
        <ion-list>
          <ion-item *ngFor="let m of members">
            <ion-checkbox
              slot="start"
              [(ngModel)]="selectedMembersMap[m.email]"
            ></ion-checkbox>
            <ion-label>{{ m.name }}</ion-label>
          </ion-item>
        </ion-list>
      </div>

      <div class="modal-actions">
        <ion-button fill="clear" (click)="closeAddExpense()">Cancel</ion-button>
        <ion-button
          (click)="confirmAddExpense()"
          [disabled]="!canAddExpense() || isSubmitting"
        >
          {{ isSubmitting ? "Adding..." : "Add" }}
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
