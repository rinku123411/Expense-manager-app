<ion-header>
  <ion-toolbar>
    <ion-title>Group Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="dashboard-content">
  <div *ngIf="isLoading" class="loading-wrapper">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <div *ngIf="!isLoading && dashboard">
    <h3>{{ dashboard.groupName }}</h3>

    <div class="dashboard-section">
      <h4>Members</h4>
      <ul>
        <li *ngFor="let m of dashboard.members">{{ m }}</li>
      </ul>
    </div>

    <div class="dashboard-section">
      <h4>Expenses</h4>
      <ul>
        <li *ngFor="let e of dashboard.expenses">
          {{ e.paidBy }} - {{ e.amount }} - {{ e.splitBetween.join(", ") }}
        </li>
      </ul>
    </div>
  </div>

  <div *ngIf="!isLoading && !dashboard">
    No dashboard data available for group {{ groupId }}.
  </div>

  <!-- Add Expense FAB -->
  <ion-fab
    vertical="bottom"
    horizontal="end"
    slot="fixed"
    class="add-expense-fab"
  >
    <ion-fab-button (click)="openAddExpense()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Modal-like container -->
  <div class="modal-backdrop" *ngIf="showAddExpense">
    <div class="modal-container">
      <h2>Add Expense</h2>

      <ion-item>
        <ion-label position="stacked">Amount</ion-label>
        <ion-input type="number" [(ngModel)]="newExpenseAmount"></ion-input>
      </ion-item>

      <ion-list>
        <ion-radio-group [(ngModel)]="splitType">
          <ion-item>
            <ion-radio slot="start" value="equal"></ion-radio>
            <ion-label>Split equally</ion-label>
          </ion-item>

          <ion-item>
            <ion-radio slot="start" value="between"></ion-radio>
            <ion-label>Split between</ion-label>
          </ion-item>
        </ion-radio-group>
      </ion-list>

      <div *ngIf="splitType === 'between'" class="members-list">
        <ion-list>
          <ion-item *ngFor="let m of dashboard?.members">
            <ion-checkbox
              slot="start"
              [(ngModel)]="selectedMembersMap[m]"
            ></ion-checkbox>
            <ion-label>{{ m }}</ion-label>
          </ion-item>
        </ion-list>
      </div>

      <div class="modal-actions">
        <ion-button fill="clear" (click)="closeAddExpense()">Cancel</ion-button>
        <ion-button
          (click)="confirmAddExpense()"
          [disabled]="!canAddExpense() || isSubmitting"
        >
          {{ isSubmitting ? "Adding..." : "Add" }}
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
