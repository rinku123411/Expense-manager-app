<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button
        (click)="goBack()"
        fill="clear"
        color="primary"
        aria-label="Back"
        class="back-button"
      >
        <ion-icon
          class="back-icon"
          slot="icon-only"
          src="assets/icon/back.svg"
        ></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Group Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="dashboard-content">
  <div *ngIf="isLoading" class="loading-wrapper">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <div *ngIf="!isLoading && dashboard">
    <h3>{{ dashboard.groupName }}</h3>

    <div class="dashboard-section">
      <h4>Members</h4>
      <ul>
        <li *ngFor="let m of members">{{ m.name }}</li>
      </ul>
    </div>

    <div class="dashboard-section">
      <h4>Expenses</h4>
      <ul>
        <li *ngFor="let e of dashboard.expenses">
          {{ e.amount }} was paid by {{ e.paidByDisplay }} and split between
          {{ e.splitBetweenDisplay.join(", ") }} for {{ e.description }}.
        </li>
      </ul>
    </div>
    <div class="settlement-section">
      <h4>Settlements</h4>
      <ul>
        <li *ngFor="let settlement of dashboard.settlements">
          {{ settlement.toDisplay }} will receive {{ settlement.amount }} rupees
          from
          {{ settlement.fromDisplay }}
        </li>
      </ul>
    </div>
  </div>

  <div *ngIf="!isLoading && !dashboard">
    No dashboard data available for group {{ groupId }}.
  </div>

  <!-- Add Expense FAB -->
  <ion-fab
    vertical="bottom"
    horizontal="end"
    slot="fixed"
    class="add-expense-fab"
  >
    <ion-fab-button (click)="openAddExpense()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Modal-like container -->
  <div class="modal-backdrop" *ngIf="showAddExpense">
    <div class="modal-container">
      <h2>Add Expense</h2>

      <ion-item>
        <ion-label position="stacked">Amount</ion-label>
        <ion-input type="number" [(ngModel)]="newExpenseAmount"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Description</ion-label>
        <ion-input
          type="string"
          [(ngModel)]="newExpenseDescription"
        ></ion-input>
      </ion-item>

      <ion-list>
        <ion-radio-group [(ngModel)]="splitType">
          <ion-item>
            <ion-radio slot="start" value="equal"></ion-radio>
            <ion-label>Split equally</ion-label>
          </ion-item>

          <ion-item>
            <ion-radio slot="start" value="between"></ion-radio>
            <ion-label>Split between</ion-label>
          </ion-item>
        </ion-radio-group>
      </ion-list>

      <div *ngIf="splitType === 'between'" class="members-list">
        <ion-list>
          <ion-item *ngFor="let m of members">
            <ion-checkbox
              slot="start"
              [(ngModel)]="selectedMembersMap[m.email]"
            ></ion-checkbox>
            <ion-label>{{ m.name }}</ion-label>
          </ion-item>
        </ion-list>
      </div>

      <div class="modal-actions">
        <ion-button fill="clear" (click)="closeAddExpense()">Cancel</ion-button>
        <ion-button
          (click)="confirmAddExpense()"
          [disabled]="!canAddExpense() || isSubmitting"
        >
          {{ isSubmitting ? "Adding..." : "Add" }}
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
